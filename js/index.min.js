var global={};!function(){addIndexOf();global.$header=$("#header");global.$search=$("#search");global.$input=$("#input");global.$searchList=global.$search.find(">.list");global.$searchSelectList=global.$search.find(".select-list");global.$searchBy=$("#searchBy");global.$settings=$("#settings");var b=getConfig();var a=getSites(b.settings.sites);var d=getSearch(b.settings.search);selSearchBy(b.settings.searchBy.id,d);setSearch(d);setTabs(a);addData("hots",a);topSearch();if(b.settings.header.show&&b.settings.header.show=="true"){setWeather(b.settings.weather)}setHeader(b.settings.header);global.sitesTabTimer=null;$("#table").on("mouseenter",".tabs",function(){global.sitesTabTimer&&clearTimeout(global.sitesTabTimer);var e=this;global.sitesTabTimer=setTimeout(function(){$("#table>ul>li").removeClass("show");addData($(e).parent().addClass("show").attr("id"),a)},300)}).on("mouseleave",".tabs",function(){clearTimeout(global.sitesTabTimer)});global.$header.find('[data-setting="list"]').on("click","a",function(){setConfig(b,{sitesData:a,searchData:d});setConfig=function(){};var f=$(this).attr("data-li");var e=$("#settings");e.find('[data-select="tabs"]').find('[data-target="'+f+'"]').addClass("active").siblings("li").removeClass("active");e.removeClass("hide").find('[data-options="select"]').children("div").removeClass("show").filter('[data-option="'+f+'"]').addClass("show")});global.$header.find('[data-show="true"]').on("click",function(){$(this).removeClass("show");global.$header.removeClass("top").find('[data-show="false"]').addClass("show");b.settings.header.show="true";setWeather(b.settings.weather);saveConfig(b,false)});global.$header.find('[data-show="false"]').on("click",function(){$(this).removeClass("show");global.$header.addClass("top").find('[data-show="true"]').addClass("show");b.settings.header.show="false";saveConfig(b,false)});global.$search.find(".input .del").on("click",function(){global.$input.val("").focus();$(this).css("visibility","hidden")});global.$input.on("input",c).on("propertychange",c).on("blur",function(){global.$searchList.removeClass("show")}).on("keydown",function(l){if(l.keyCode==13){var m=global.$input.val()||global.$input.attr("placeholder");saveKw(m);open(d[b.settings.searchBy.id].urlKw+encodeURI(m),"_blank")}else{if(l.keyCode==40||l.keyCode==38){global.$input.off("propertychange");var n=global.$searchList.find("li");var h=0;var g=n.parent().scrollTop();var k=n.filter(".hover");var j=$();var i=n.height();if(l.keyCode==40){if(k.length>0&&k.is(".search>.list li:last-child")){n.removeClass("hover");g=0}else{if(k.length>0&&k.is(".search>.list li")){k.removeClass("hover").next().addClass("hover")}else{n.removeClass("hover").first().addClass("hover")}j=n.filter(".hover");h=n.index(j);if(g<i*(h-9)){g=i*(h-9)}else{if(h==0){g=0}}}}else{if(l.keyCode==38){if(k.length>0&&k.is(".search>.list li:first-child")){n.removeClass("hover")}else{if(k.length>0&&k.is(".search>.list li")){k.removeClass("hover").prev().addClass("hover")}else{n.removeClass("hover").last().addClass("hover")}j=n.filter(".hover");h=n.index(j);if(g>i*h){g=i*h}else{if(h==n.length-1){g=i*(h-9)}}}}}n.parent().scrollTop(g);preventAndStop(l,true,false);global.$input.val(j.find("a span").text()||j.find("a").text()||global.inputVal);var f=global.$search.find(".input .del");if(global.$input.val().length>0){f.css("visibility","visible")}else{f.css("visibility","hidden")}global.$input.on("propertychange",c)}}}).on("focus",function(){global.$searchSelectList.addClass("hide")}).on("click",function(j){if($(this).val()==""){var k=localSave("kw");if(!k){return false}var f=JSON.parse(k);var h="";for(var g=0;g<f.length;g++){h+='<li><a target="_blank" href="'+d[b.settings.searchBy.id].urlKw+encodeURI(f[g])+'"><span>'+f[g]+'</span><s class="del" title="删除">×</s></a></li>'}global.$searchList.find(">ul").html(h)}if(global.$searchList.find("li").length>0){global.$searchList.addClass("show")}});global.$searchList.on("mousedown",".del",function(f){if(f.button==2){return false}preventAndStop(f,true,true);delKw($(this).parent().find("span").text());$(this).parent().parent().remove()}).on("mousedown","a",function(g){if(g.button==2){return false}var f=$(this).children("span").text()||$(this).text();preventAndStop(g,true,true);open(d[b.settings.searchBy.id].urlKw+encodeURI(f),"_blank");saveKw(f)}).on("mouseenter","li",function(){$(this).addClass("hover").siblings().removeClass("hover")}).find("ul").on("scroll",function(){global.$searchList.off("mouseenter","li");setTimeout(function(){global.$searchList.on("mouseenter","li",function(){$(this).addClass("hover").siblings().removeClass("hover")})},100)});$("#btnSearch").on("click",function(){var e=global.$input.val()||global.$input.attr("placeholder");saveKw(e);open(d[b.settings.searchBy.id].urlKw+encodeURI(e),"_blank")});global.$searchBy.on("click",function(){global.$searchSelectList.removeClass("hide")});global.$searchSelectList.on("click","li",function(){var e=$(this).children("s").attr("class");if(d[e].urlKw&&d[e].urlKw.length>0){selSearchBy(e,d);b.settings.searchBy.id=e;saveConfig(b,false)}else{setToast("配置错误");return false}}).on("mouseleave",function(){$(this).addClass("hide")});global.keyupTimer=null;global.inputVal="";function c(){global.keyupTimer&&clearTimeout(global.keyupTimer);global.inputVal=$(this).val();var e=global.$search.find(".input .del");if(global.inputVal.length>0){e.css("visibility","visible")}else{e.css("visibility","hidden");global.$searchList.removeClass("show").html("<ul></ul>");return false}global.keyupTimer=setTimeout(function(){$.getJSON("https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?cb=?",{wd:global.inputVal,ie:"utf-8"},function(h){var g="";for(var f=0;f<h.s.length;f++){g+='<li><a target="_blank" href="'+d[b.settings.searchBy.id].urlKw+encodeURI(h.s[f])+'">'+h.s[f]+"</a></li>"}if(g==""){global.$searchList.removeClass("show").html("<ul></ul>")}else{global.$searchList.html("<ul>"+g+"</ul>").addClass("show")}})},200)}}();function getConfig(){var a=localSave("config");if(!a){$.ajax({async:false,type:"GET",url:"config.json",dataType:"json",success:function(b){a=b;localSave("config",JSON.stringify(a))},error:function(){setToast("配置数据错误");return false}});return a}else{return JSON.parse(a)}}function getSites(a){var b=null;if("url" in a[a.src]){$.ajax({async:false,type:"GET",url:a[a.src].url,dataType:"json",success:function(c){b=c},error:function(){setToast("配置数据错误");return false}});return b}else{if("data" in a[a.src]){b=localSave("sites");if(!b){$.ajax({async:false,type:"GET",url:"sites.json",dataType:"json",success:function(c){b=c;localSave("sites",JSON.stringify(b))},error:function(){setToast("配置数据错误");return false}});return b}else{return JSON.parse(b)}}}}function getSearch(b){var a=null;if("url" in b[b.src]){$.ajax({async:false,type:"GET",url:b[b.src].url,dataType:"json",success:function(c){a=c},error:function(){setToast("配置数据错误");return false}});return a}else{a=localSave("search");if(!a){$.ajax({async:false,type:"GET",url:"search.json",dataType:"json",success:function(c){a=c;localSave("search",JSON.stringify(a))},error:function(){setToast("配置数据错误");return false}});return a}else{return JSON.parse(a)}}}function setSearch(d){var b="";for(var a in d){var c="";if(!d[a].position){c="background-position:0 0;background-size:20px 20px"}else{c="background-position:"+d[a].position}b+='<li><s class="'+a+'" style="background-image:url('+d[a].icon+");"+c+'" data-url="'+d[a].urlKw+'" data-position="'+d[a].position+'"></s><span>'+d[a].title+"</span></li>"}global.$searchSelectList.append(b)}function selSearchBy(e,d){global.$searchBy.css("backgroundPosition",d[e].position);var c=$(".main>.logo");var b=c.find("img");var a=c.find("h1");if(!d[e].logo){b.css("display","none");a.css("display","block").text(d[e].title)}else{a.css("display","none");b.attr({src:d[e].logo,alt:d[e].title}).css("display","inline-block")}c.find(">a").attr("href",d[e].url);global.$searchSelectList.addClass("hide");$('head [rel="shortcut icon"]').attr("href",d[e].url+"/favicon.ico")}function setTabs(a){var c="";for(var b in a.tabs){c+='<li id="'+b+'"><span class="tabs">'+a.tabs[b]+'</span><div><ul class="sites clear"></ul></div></li>'}$("#table>ul").append($(c))}function addData(d,a){if($("#"+d+":not(.finish) .sites").length>0){var c="";for(var b=0;b<a.sites[d].length;b++){var e="";if(a.sprites[d]&&a.sprites[d].length>0){e="background-image:url("+a.sprites[d]+");background-position:"+a.sites[d][b].position}if(a.sites[d][b].img&&a.sites[d][b].img.length>0){e="background-image:url("+a.sites[d][b].img+");background-size:20px 20px"}var f="";if(a.sites[d][b].intro&&a.sites[d][b].intro.length>0){f=a.sites[d][b].intro}c+='<li title="'+f+'"><a target="_blank" href="'+a.sites[d][b].url+'"><s style="'+e+'"></s><span>'+a.sites[d][b].title+"</span></a></li>"}$("#"+d).addClass("finish").addClass("show").find(".sites").append($(c));addSitesCss()}}function topSearch(){$.getJSON("top_search.json",function(a){global.$input.attr("placeholder",a[Math.floor(Math.random()*a.length)]);setPlaceholder()})}function setWeather(a){if(a.show=="true"&&!global.$header.find(".weather").hasClass("finish")){showWeather(a);global.$header.find(".weather").on("mouseenter",function(){global.weatherTimer&&clearInterval(global.weatherTimer)}).on("mouseleave",function(){global.weatherTimer=setInterval(weatherAnimat,3000)})}}function showWeather(a){var b=a[a.location].city||"北京";$('[data-city="city"]').text(b);$.getJSON("https://dh.wwzc.cc/weather.php",{city:b},function(k){var i=k.data.weather.content.today.img[0];var f=k.data.weather.content.currenttemp;var l=k.data.weather.content.today.pm25;var m=k.data.weather.content.today.condition;var e="优";var c=k.data.weather.content.tomorrow.img[0];var g=k.data.weather.content.tomorrow.temp;var h=k.data.weather.content.tomorrow.pm25;var d=k.data.weather.content.tomorrow.condition;var j="优";if(l>250){e="严重污染"}else{if(l>150){e="重度污染"}else{if(l>115){e="中度污染"}else{if(l>75){e="轻度污染"}else{if(l>35){e="良"}}}}}if(h>250){j="严重污染"}else{if(h>150){j="重度污染"}else{if(h>115){j="中度污染"}else{if(h>75){j="轻度污染"}else{if(h>35){j="良"}}}}}global.$header.find('[data-weather-today="img"]').attr({src:i,alt:m,title:m});global.$header.find('[data-weather-today="temp"]').text(f);global.$header.find('[data-weather-today="aqi"]').text(e);global.$header.find('[data-weather-tomorrow="img"]').attr({src:c,alt:d,title:d});global.$header.find('[data-weather-tomorrow="temp"]').text(g);global.$header.find('[data-weather-tomorrow="aqi"]').text(j);global.weatherTimer=setInterval(weatherAnimat,3000);global.$header.find("[data-weather-show]").removeClass("hide");global.$header.find(".weather").addClass("finish")})}global.weatherAnimatJquery={tomorrow:$(".weather .tomorrow"),today:$(".weather .today")};function weatherAnimat(){if(global.weatherAnimatJquery.tomorrow.hasClass("current")){setTimeout(function(){global.weatherAnimatJquery.tomorrow.removeClass("current")},1000)}else{global.weatherAnimatJquery.tomorrow.addClass("current")}if(global.weatherAnimatJquery.today.hasClass("current")){setTimeout(function(){global.weatherAnimatJquery.today.removeClass("current")},1000)}else{global.weatherAnimatJquery.today.addClass("current").css("zIndex",2);setTimeout(function(){global.weatherAnimatJquery.today.css("zIndex",0)},2000)}}function setHeader(a){if(a.show=="true"){global.$header.removeClass("top");global.$header.find('[data-show="true"]').removeClass("show");global.$header.find('[data-show="false"]').addClass("show")}else{global.$header.addClass("top");global.$header.find('[data-show="false"]').removeClass("show");global.$header.find('[data-show="true"]').addClass("show")}}function setConfig(a,b){setConfigSites(a.settings.sites,b.sitesData);setConfigSearch(a.settings.search,b.searchData);setConfigWeather(a.settings.weather);setConfigTheme(a.settings.theme);global.$settings.find('[data-select="tabs"]').on("click","li",function(){$(this).addClass("active").siblings("li").removeClass("active");global.$settings.find('[data-options="select"]').children("div").removeClass("show").filter('[data-option="'+$(this).attr("data-target")+'"]').addClass("show")});global.$settings.find("[data-close]").on("click",function(){global.$settings.addClass("hide")});global.$settings.find(':radio[name="sitesrc"]').on("change",function(){var c=$(this).attr("id").split("_").pop();global.$settings.find("[data-sites]").removeClass("show").filter('[data-sites="'+c+'"]').addClass("show")});global.$settings.find(':radio[name="search"]').on("change",function(){var c=$(this).attr("id").split("_").pop();global.$settings.find("[data-search]").removeClass("show").filter('[data-search="'+c+'"]').addClass("show")});global.$settings.find(':radio[name="weather"]').on("change",function(){if($(this).attr("id")=="weather_false"){global.$settings.find('[data-option="weather"]>div:not(:last-child):not(:first-child)').removeClass("show")}else{var c=$(':radio[name="location"]:checked').attr("id").split("_").pop();global.$settings.find('[data-option="weather"]>div:not(:last-child):not(:first-child)').addClass("show").filter("[data-weather]").removeClass("show").filter('[data-weather="'+c+'"]').addClass("show")}});global.$settings.find(':radio[name="location"]').on("change",function(){var c=$(this).attr("id").split("_").pop();if(c=="ip"){global.$settings.find("[data-weather-ip-tips]").text("获取中");$.getJSON("https://dh.wwzc.cc/get_ip.php?v="+(new Date()).getTime(),function(d){if(d.code==0){global.$settings.find("[data-weather-ip-tips]").text("成功");global.$settings.find("[data-weather-ip]").val(d.data.city)}else{global.$settings.find("[data-weather-ip-tips]").text("失败")}})}else{if(c=="geog"){getGeog()}}global.$settings.find("[data-weather]").removeClass("show").filter('[data-weather="'+c+'"]').addClass("show")});global.$settings.find(':radio[name="theme"]').on("change",function(){var c=$(this).attr("id").split("_").pop();global.$settings.find("[data-theme]").removeClass("show").filter('[data-theme="'+c+'"]').addClass("show")});global.$settings.find("[data-sites-save]").on("click",function(){var d=global.$settings.find(':radio[name="sitesrc"]:checked').attr("id").split("_").pop();var c=global.$settings.find("[data-sites-"+d+"]").val();a.settings.sites.src=d;if("url" in a.settings.sites[d]){a.settings.sites[d].url=c}else{if("data" in a.settings.sites[d]){if(vSites(c)){saveSites(c)}else{setToast("配置保存失败");return false}}}saveConfig(a,true)});global.$settings.find("[data-search-save]").on("click",function(){var d=global.$settings.find(':radio[name="search"]:checked').attr("id").split("_").pop();var c=global.$settings.find("[data-search-"+d+"]").val();a.settings.search.src=d;if("url" in a.settings.search[d]){a.settings.search[d].url=c}else{if("data" in a.settings.search[d]){if(vSearch(c)){saveSearch(c)}else{setToast("配置保存失败");return false}}}saveConfig(a,true)});global.$settings.find("[data-weather-save]").on("click",function(){var d=global.$settings.find(':radio[name="weather"]:checked').attr("id").split("_").pop();var c=global.$settings.find(':radio[name="location"]:checked').attr("id").split("_").pop();var e=global.$settings.find("[data-weather-"+c+"]").val();a.settings.weather.show=d;a.settings.weather.location=c;a.settings.weather[c].city=e;saveConfig(a,true)})}function setConfigSites(b,a){global.$settings.find("[data-sites-local]").val(JSON.stringify(a));global.$settings.find("[data-sites-default]").val(b["default"].url);global.$settings.find("[data-sites-other]").val(b.other.url);$("#src_sites_"+b.src).attr("checked","true");global.$settings.find("[data-sites]").removeClass("show").filter('[data-sites="'+b.src+'"]').addClass("show")}function setConfigSearch(b,a){global.$settings.find("[data-search-local]").val(JSON.stringify(a));global.$settings.find("[data-search-default]").val(b["default"].url);global.$settings.find("[data-search-other]").val(b.other.url);$("#src_search_"+b.src).attr("checked","true");global.$settings.find("[data-search]").removeClass("show").filter('[data-search="'+b.src+'"]').addClass("show")}function setConfigWeather(a){$("#weather_"+a.show).attr("checked",true);global.$settings.find("[data-weather-ip]").val(a.ip.city);global.$settings.find("[data-weather-geog]").val(a.geog.city);global.$settings.find("[data-weather-user]").val(a.user.city);$("#location_"+a.location).attr("checked","true");if(a.show=="true"){global.$settings.find('[data-option="weather"]>div').addClass("show").filter("[data-weather]").removeClass("show").filter('[data-weather="'+a.location+'"]').addClass("show")}}function setConfigTheme(a){$("#theme_"+a.src).attr("checked","true");global.$settings.find("[data-theme]").removeClass("show").filter('[data-theme="'+a.src+'"]').addClass("show")}function getGeog(){var a=global.$settings.find("[data-weather-geog-tips]");var b=global.$settings.find("[data-weather-geog]");a.text("获取中");if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(c){$.getJSON("https://api.map.baidu.com/geocoder/v2/?ak=LjQMvqTu71wsnzIcjAQKIWykPN1S9uQ7&callback=?&location="+c.coords.latitude+","+c.coords.longitude+"&output=json&pois=1",function(d){a.text("成功");b.val(d.result.addressComponent.district.replace(/[区,县,市,省]$/,""))})},function(c){a.text("失败");b.val("")})}else{a.text("失败");b.val("")}}global.toastTimer=null;function setToast(b){var a=$("#toast");if(b){a.addClass("show").find("[data-toast-text]").text(b);global.toastTimer&&clearTimeout(global.toastTimer);global.toastTimer=setTimeout(function(){a.removeClass("show")},2000)}else{a.removeClass("show")}}function vConfig(b){try{var a=true;JSON.stringify(b);if("url" in b.settings.sites[b.settings.sites.src]){$.ajax({async:false,type:"GET",url:b.settings.sites[b.settings.sites.src].url,dataType:"text",success:function(d){if(!vSites(d)){a=false}},error:function(){a=false}});if(!a){return false}}else{if("data" in b.settings.sites[b.settings.sites.src]){}else{return false}}if("url" in b.settings.search[b.settings.search.src]){$.ajax({async:false,type:"GET",url:b.settings.search[b.settings.search.src].url,dataType:"text",success:function(d){if(!vSearch(d)){a=false}},error:function(){a=false}});if(!a){return false}}else{if("data" in b.settings.search[b.settings.search.src]){}else{return false}}if(b.settings.weather.show=="true"){$.ajax({async:false,type:"GET",url:"https://dh.wwzc.cc/weather.php",data:{city:b.settings.weather[b.settings.weather.location].city},dataType:"json",success:function(d){if(!d.data.weather.content.today.pm25){a=false}},error:function(){a=false}});if(!a){return false}}else{if(b.settings.weather.show=="false"){}else{return false}}if(!(b.settings.header.show=="true"||b.settings.header.show=="false")){return false}return true}catch(c){return false}}function vSites(f){try{var a=JSON.parse(f);for(var c in a.tabs){if(a.sites[c]){for(var b in a.sites[c]){if(a.sites[c][b].title.length<1){return false}}}else{return false}}return true}catch(d){return false}}function vSearch(a){try{var c=JSON.parse(a);for(var b in c){if(c[b].title.length<1||c[b].urlKw.length<1){return false}}return true}catch(d){return false}}function saveSites(a){try{localSave("sites",a);return true}catch(b){return false}}function saveSearch(a){try{localSave("search",a);return true}catch(b){return false}}function saveConfig(b,a){if(a){if(!vConfig(b)){setToast("配置保存失败");return false}}localSave("config",JSON.stringify(b));setToast("配置已保存");return true}function saveKw(c){var d=localSave("kw")||"[]";var a=JSON.parse(d);var b=a.indexOf(c);if(b!=-1){a.splice(b,1)}a.unshift(c);localSave("kw",JSON.stringify(a))}function preventAndStop(c,b,a){if(b){if(c&&c.preventDefault){c.preventDefault()}else{window.event.returnValue=false}}if(a){if(c&&c.stopPropagation){c.stopPropagation()}else{window.event.cancelBubble=true}}}function addIndexOf(){if(!Array.indexOf){Array.prototype.indexOf=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return a}}return -1}}}function setPlaceholder(){if(!("placeholder" in document.createElement("input"))){var b=global.$search.find('[data-input="placeholder"]');b.addClass("show");b.text(global.$input.attr("placeholder")).on("click",function(){global.$input.click().focus()});global.$input.on("keyup",a).on("propertychange",a);function a(){if(global.$input.val().length>0){b.removeClass("show")}else{b.addClass("show")}}}}function addSitesCss(){if(!$.support.cssFloat){$(".main .table .sites li:nth-child(6n)").css("marginRight",0)}}function delKw(c){var d=localSave("kw")||"[]";var a=JSON.parse(d);var b=a.indexOf(c);if(b!=-1){a.splice(b,1);localSave("kw",JSON.stringify(a))}}function localSave(a,b){if(typeof(localStorage)=="undefined"){localStorage=(new (function(){var g=60*60*24*1000;var h="/";var e=c();function c(){var l={};var m=document.cookie;if(m===""){return l}var q=m.split("; ");for(var k=0;k<q.length;k++){var n=q[k];var r=n.indexOf("=");var j=n.substring(0,r);var o=n.substring(r+1);l[j]=o}return l}var f=[];for(var d in e){f.push(d)}this.length=f.length;this.key=function(i){if(i<0||i>=f.length){return null}return f[i]};this.setItem=function(i,k){if(!(i in e)){f.push(i);this.length++}e[i]=k;var j=i+"="+k;if(g){j+="; max-age="+g}if(h){j+="; path="+h}document.cookie=j};this.getItem=function(i){return e[i]||null};this.removeItem=function(k){if(!(k in e)){return}delete e[k];for(var j=0;j<f.length;j++){if(f[j]===k){f.splice(j,1);break}}this.length--;document.cookie=k+"=; max-age=0"};this.clear=function(){for(var j=0;j<f.length;j++){document.cookie=f[j]+"; max-age=0"}e={};f=[];this.length=0}})())}if(a==""){localStorage.clear();return true}else{if(b!==undefined){localStorage.setItem(a,b);return true}else{if(b==""){localStorage.removeItem(a);return true}else{return localStorage.getItem(a)}}}};